#===================================================================================
# DRONE SWARM SIMULATION - Configuração Essencial
# Enxame de Drones com Tecnologias Apropriadas
#===================================================================================
# Foco: Coordenação, comunicação e comportamento coletivo
#===================================================================================

[General]
network = DroneSwarmNetwork
sim-time-limit = 300s                   # 5 minutos suficiente para análise
seed-set = ${repetition}
repeat = 3
cmdenv-express-mode = true

#===================================================================================
# TOPOLOGIA DO ENXAME
#===================================================================================
*.numDrones = 10                        # 10 drones = enxame gerenciável
*.numGCS = 1                            # Uma base de controle

#===================================================================================
# MOBILIDADE - Padrão de Voo Coordenado
#===================================================================================
# Gauss-Markov é adequado para enxames pois:
# - Simula movimento suave e contínuo
# - Alpha controla coesão do grupo
# - Permite autonomia individual mantendo coordenação

*.drone[*].mobility.typename = "GaussMarkovMobility"

# Espaço aéreo operacional (ajustado para ser visível no canvas)
*.drone[*].mobility.constraintAreaMinX = 0m
*.drone[*].mobility.constraintAreaMaxX = 800m
*.drone[*].mobility.constraintAreaMinY = 0m
*.drone[*].mobility.constraintAreaMaxY = 800m
*.drone[*].mobility.constraintAreaMinZ = 40m    # Altura segura
*.drone[*].mobility.constraintAreaMaxZ = 120m   # Limite regulatório
*.drone[*].mobility.margin = 10m

# Velocidade de cruzeiro típica
*.drone[*].mobility.speed = 15mps               # 54 km/h - eficiente
*.drone[*].mobility.speedStdDev = 0mps          # Velocidade constante
*.drone[*].mobility.angle = uniform(0deg, 360deg)
*.drone[*].mobility.angleStdDev = 30deg

# Alpha = 0.8 favorece coesão do enxame
*.drone[*].mobility.alpha = 0.8                 # Alto = movimento coordenado
*.drone[*].mobility.updateInterval = 0.5s       # Atualização suave

# Posição inicial dentro da área (distribuição uniforme)
*.drone[*].mobility.initialX = uniform(100m, 700m)
*.drone[*].mobility.initialY = uniform(100m, 700m)
*.drone[*].mobility.initialZ = 60m              # Mesma altura inicial

#===================================================================================
# COMUNICAÇÃO - WiFi 5 GHz (Padrão para Drones)
#===================================================================================
# IEEE 802.11ac é o adequado para enxames modernos:
# - Maior throughput que 802.11n
# - 5 GHz = menos interferência
# - Suporte a múltiplos streams
# - Range adequado (300-500m)

*.drone[*].numWlanInterfaces = 1
*.drone[*].wlan[0].typename = "Ieee80211Interface"
*.drone[*].wlan[0].mgmt.typename = "Ieee80211MgmtAdhoc"
*.drone[*].wlan[0].radio.typename = "Ieee80211ScalarRadio"

# 5 GHz - faixa apropriada para drones
*.drone[*].wlan[0].radio.bandName = "5 GHz"
*.drone[*].wlan[0].radio.carrierFrequency = 5.8GHz      # Canal comum de FPV
*.drone[*].wlan[0].radio.bandwidth = 40MHz              # 802.11ac permite 40/80 MHz

# Potência típica de módulos comerciais (e.g., ESP32, RFD900)
*.drone[*].wlan[0].radio.transmitter.power = 100mW      # 20 dBm = legal em vários países

# Sensibilidade de receptores modernos
*.drone[*].wlan[0].radio.receiver.sensitivity = -92dBm
*.drone[*].wlan[0].radio.receiver.energyDetection = -95dBm
*.drone[*].wlan[0].radio.receiver.snirThreshold = 4dB

#===================================================================================
# PROPAGAÇÃO - Modelo Realista para Ambientes Externos
#===================================================================================
# Two-Ray Ground Reflection é mais realista que Free Space para drones:
# - Considera reflexão no solo
# - Mais preciso para alturas 40-120m
# - Usado em análises de drones comerciais

*.radioMedium.typename = "Ieee80211ScalarRadioMedium"
*.radioMedium.pathLossType = "TwoRayGroundReflection"
*.radioMedium.propagationType = "ConstantSpeedPropagation"
*.radioMedium.backgroundNoise.power = -96dBm            # Ambiente rural/suburbano

#===================================================================================
# ENERGIA - Bateria Realista
#===================================================================================
# Removido - usar modelo de energia do INET se necessário

#===================================================================================
# ROTEAMENTO - OLSR (Melhor para Enxames que AODV)
#===================================================================================
*.drone[*].hasIpv4 = true
*.drone[*].ipv4.routingTable.netmaskRoutes = ""

# OLSR como protocolo de roteamento
*.configurator.addStaticRoutes = false
*.configurator.addDefaultRoutes = false
*.configurator.addSubnetRoutes = false

#===================================================================================
# APLICAÇÃO - Tráfego de Coordenação do Enxame
#===================================================================================
# Enxames trocam:
# - Posição/velocidade (telemetria)
# - Estado/missão
# - Comandos cooperativos
# Total: ~100-200 kbps por drone é suficiente

*.drone[*].numApps = 1
*.drone[*].app[0].typename = "UdpBasicApp"

# Broadcast para todos os drones (coordenação)
*.drone[*].app[0].destAddresses = "224.0.0.1"           # Multicast
*.drone[*].app[0].destPort = 4000
*.drone[*].app[0].localPort = 4000

# Telemetria: 150 kbps = 100-200 bytes @ 10 Hz
*.drone[*].app[0].messageLength = 150B                  # Pacote de estado
*.drone[*].app[0].sendInterval = 100ms                  # 10 Hz = tempo real

*.drone[*].app[0].startTime = uniform(1s, 3s)
*.drone[*].app[0].stopTime = 295s

# GCS monitora (não necessariamente recebe todo tráfego)
# Posicionada no canto inferior direito com distância da borda
*.gcs[*].mobility.typename = "StationaryMobility"
*.gcs[*].mobility.initFromDisplayString = false
*.gcs[*].mobility.initialX = 750m               # Canto direito (50m da borda)
*.gcs[*].mobility.initialY = 750m               # Canto inferior (50m da borda)
*.gcs[*].mobility.initialZ = 2m                 # Nível do solo

#===================================================================================
# VISUALIZAÇÃO SIMPLES
#===================================================================================
*.visualizer.typename = "IntegratedCanvasVisualizer"
*.visualizer.mobilityVisualizer.displayMovements = true
*.visualizer.mobilityVisualizer.trailLength = 20

#===================================================================================
# ESTATÍSTICAS ESSENCIAIS
#===================================================================================
**.scalar-recording = true
**.vector-recording = true

# Métricas críticas para enxames
*.drone[*].app[0].packetSent:count.statistic = "sent"
*.drone[*].app[0].packetReceived:count.statistic = "received"
*.drone[*].wlan[0].radio.receptionState:vector.statistic = "radioState"

#===================================================================================
# CENÁRIOS
#===================================================================================

[Config Base]
extends = General
description = "Enxame base - 10 drones coordenados"

[Config Small]
extends = General
description = "Enxame pequeno - 5 drones"
*.numDrones = 5

[Config Large]
extends = General
description = "Enxame grande - 20 drones"
*.numDrones = 20

[Config HighSpeed]
extends = General
description = "Enxame rápido - 25 m/s"
*.drone[*].mobility.speed = 25mps

[Config Formation]
extends = General
description = "Formação em grid inicial"
*.drone[*].mobility.initialX = (ancestorIndex(0) % 5) * 100m + 200m
*.drone[*].mobility.initialY = (ancestorIndex(0) / 5) * 100m + 200m
*.drone[*].mobility.alpha = 0.9                         # Mantém formação

#===================================================================================
# NOTAS TÉCNICAS
#===================================================================================
#
# ESCOLHAS TÉCNICAS E JUSTIFICATIVAS:
#
# 1. OLSR vs AODV:
#    - OLSR: proativo, rotas sempre prontas, melhor para mesh denso
#    - AODV: reativo, economiza banda mas latência maior
#    - Enxames = OLSR (comunicação frequente)
#
# 2. Two-Ray vs Free Space:
#    - Two-Ray mais realista para 40-120m de altitude
#    - Considera reflexão do solo
#    - Free Space subestima path loss
#
# 3. 5.8 GHz vs 2.4 GHz:
#    - 5.8 GHz: menos congestionado, FPV padrão
#    - 2.4 GHz: maior range mas interferência
#    - Comercial usa 5.8 (DJI, etc)
#
# 4. Bateria 30 Wh:
#    - Drones 250-500g típico
#    - 15-20 min realista
#    - 100 Wh irreal para maioria dos cenários
#
# 5. Multicast:
#    - Enxames comunicam com todos
#    - Mais eficiente que múltiplos unicast
#    - Overhead menor
#
# 6. Alpha 0.8:
#    - Balance autonomia/coesão
#    - 0.9 = muito rígido
#    - 0.7 = muito disperso
#
# PARA EXECUTAR:
# ./swarm -u Cmdenv -c Base
#
#===================================================================================